<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Glue::ElasticSearch::Repository
  
    &mdash; Katello
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Glue.html" title="Glue (module)">Glue</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../ElasticSearch.html" title="Glue::ElasticSearch (module)">ElasticSearch</a></span></span>
     &raquo; 
    <span class="title">Repository</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Glue::ElasticSearch::Repository
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="../../Repository.html" title="Repository (class)">Repository</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">
      <a href="https://github.com/Katello/katello/tree/master/app/models/glue/elastic_search/repository.rb" target="_blank">
        app/models/glue/elastic_search/repository.rb
      </a>
    </dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#included-class_method" title="included (class method)">+ (Object) <strong>included</strong>(base) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clear_content_indices-instance_method" title="#clear_content_indices (instance method)">- (Object) <strong>clear_content_indices</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#errata_count-instance_method" title="#errata_count (instance method)">- (Object) <strong>errata_count</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extended_index_attrs-instance_method" title="#extended_index_attrs (instance method)">- (Object) <strong>extended_index_attrs</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index_content-instance_method" title="#index_content (instance method)">- (Object) <strong>index_content</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index_errata-instance_method" title="#index_errata (instance method)">- (Object) <strong>index_errata</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index_package_groups-instance_method" title="#index_package_groups (instance method)">- (Object) <strong>index_package_groups</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index_packages-instance_method" title="#index_packages (instance method)">- (Object) <strong>index_packages</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#package_count-instance_method" title="#package_count (instance method)">- (Object) <strong>package_count</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_errata_index-instance_method" title="#update_errata_index (instance method)">- (Object) <strong>update_errata_index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_package_group_index-instance_method" title="#update_package_group_index (instance method)">- (Object) <strong>update_package_group_index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_packages_index-instance_method" title="#update_packages_index (instance method)">- (Object) <strong>update_packages_index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_related_index-instance_method" title="#update_related_index (instance method)">- (Object) <strong>update_related_index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="included-class_method">
  
    + (<tt>Object</tt>) <strong>included</strong>(base) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 15</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_included'>included</span><span class='lparen'>(</span><span class='id identifier rubyid_base'>base</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span> <span class='symbol'>:include</span><span class='comma'>,</span> <span class='const'>Ext</span><span class='op'>::</span><span class='const'>IndexedModel</span>

  <span class='id identifier rubyid_base'>base</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_index_options'>index_options</span> <span class='symbol'>:extended_json</span><span class='op'>=&gt;</span><span class='symbol'>:extended_index_attrs</span><span class='comma'>,</span>
                  <span class='symbol'>:json</span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='symbol'>:except</span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='symbol'>:pulp_repo_facts</span><span class='comma'>,</span> <span class='symbol'>:feed_cert</span><span class='comma'>,</span> <span class='symbol'>:environment_product_id</span><span class='rbracket'>]</span><span class='rbrace'>}</span>

    <span class='id identifier rubyid_mapping'>mapping</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_indexes'>indexes</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>string</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:analyzer</span> <span class='op'>=&gt;</span> <span class='symbol'>:kt_name_analyzer</span>
      <span class='id identifier rubyid_indexes'>indexes</span> <span class='symbol'>:name_sort</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>string</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:index</span> <span class='op'>=&gt;</span> <span class='symbol'>:not_analyzed</span>
      <span class='id identifier rubyid_indexes'>indexes</span> <span class='symbol'>:labels</span><span class='comma'>,</span> <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>string</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:index</span> <span class='op'>=&gt;</span> <span class='symbol'>:not_analyzed</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_after_save'>after_save</span> <span class='symbol'>:update_related_index</span>
    <span class='id identifier rubyid_before_destroy'>before_destroy</span> <span class='symbol'>:clear_content_indices</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_extended_index_attrs'>extended_index_attrs</span>
    <span class='lbrace'>{</span><span class='symbol'>:environment</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_environment'>environment</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:environment_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_environment'>environment</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:clone_ids</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clones'>clones</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:pulp_id</span><span class='rparen'>)</span><span class='comma'>,</span>
     <span class='symbol'>:product</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:product_id</span><span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
     <span class='symbol'>:default_content_view</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content_view_version'>content_view_version</span><span class='period'>.</span><span class='id identifier rubyid_has_default_content_view?'>has_default_content_view?</span><span class='comma'>,</span>
     <span class='symbol'>:name_sort</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_related_index'>update_related_index</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_update_index'>update_index</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:update_index</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_index_packages'>index_packages</span>
    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='op'>::</span><span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_pkgs'>pkgs</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_packages'>packages</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pkg'>pkg</span><span class='op'>|</span> <span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_pkgs'>pkgs</span><span class='period'>.</span><span class='id identifier rubyid_each_slice'>each_slice</span><span class='lparen'>(</span><span class='const'>Katello</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_pulp'>pulp</span><span class='period'>.</span><span class='id identifier rubyid_bulk_load_size'>bulk_load_size</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sublist'>sublist</span><span class='op'>|</span>
      <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='op'>::</span><span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_sublist'>sublist</span>
      <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_sublist'>sublist</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_packages_index'>update_packages_index</span>
    <span class='comment'># for each of the packages in the repo, unassociate the repo from the package
</span>    <span class='id identifier rubyid_pkgs'>pkgs</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_packages'>packages</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pkg'>pkg</span><span class='op'>|</span> <span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_pulp_id'>pulp_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span>

    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>

      <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_pkgs'>pkgs</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_documents'>documents</span><span class='op'>|</span>
        <span class='id identifier rubyid_documents'>documents</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_document'>document</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
            <span class='comment'># if there is more than 1 repo associated w/ the pkg, remove this repo
</span>            <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pkgs'>pkgs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='comment'># now, for any package that only had this repo asscociated with it, remove the package from the index
</span>    <span class='id identifier rubyid_repoids'>repoids</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>/katello_package/_query?q=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_repoids'>repoids</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>katello_package</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_refresh'>refresh</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_index_errata'>index_errata</span>
    <span class='id identifier rubyid_errata'>errata</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_err'>err</span><span class='op'>|</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>
      <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_errata'>errata</span>
    <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_errata_index'>update_errata_index</span>
    <span class='comment'># for each of the errata in the repo, unassociate the repo from the errata
</span>    <span class='id identifier rubyid_errata'>errata</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_err'>err</span><span class='op'>|</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_pulp_id'>pulp_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span>

    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>

      <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_errata'>errata</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_documents'>documents</span><span class='op'>|</span>
        <span class='id identifier rubyid_documents'>documents</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_document'>document</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
            <span class='comment'># if there is more than 1 repo associated w/ the errata, remove this repo
</span>            <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

    <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='comment'># now, for any errata that only had this repo asscociated with it, remove the errata from the index
</span>    <span class='id identifier rubyid_repoids'>repoids</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>/katello_errata/_query?q=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_repoids'>repoids</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>katello_errata</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_refresh'>refresh</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_index_package_groups'>index_package_groups</span>
    <span class='id identifier rubyid_package_groups_map'>package_groups_map</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_package_groups'>package_groups</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pg'>pg</span><span class='op'>|</span> <span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>PackageGroup</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>PackageGroup</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>PackageGroup</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>
      <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_package_groups_map'>package_groups_map</span>
    <span class='kw'>end</span> <span class='kw'>unless</span> <span class='id identifier rubyid_package_groups_map'>package_groups_map</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_update_package_group_index'>update_package_group_index</span>
    <span class='comment'># for each of the package_groups in the repo, unassociate the repo from the package_group
</span>    <span class='id identifier rubyid_pgs'>pgs</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_package_groups'>package_groups</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pg'>pg</span><span class='op'>|</span> <span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_pulp_id'>pulp_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span>

    <span class='comment'># now, for any package group that only had this repo asscociated with it,
</span>    <span class='comment'># remove the package group from the index
</span>    <span class='id identifier rubyid_repoid'>repoid</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repo_id:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>/katello_package_group/_query?q=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_repoid'>repoid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>katello_package_group</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_refresh'>refresh</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_errata_count'>errata_count</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:repoids</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_total'>total</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_package_count'>package_count</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:repoids</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_total'>total</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_index_content'>index_content</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_index_packages'>index_packages</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_index_errata'>index_errata</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_index_package_groups'>index_package_groups</span>
    <span class='kw'>true</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_clear_content_indices'>clear_content_indices</span>
    <span class='id identifier rubyid_update_packages_index'>update_packages_index</span>
    <span class='id identifier rubyid_update_errata_index'>update_errata_index</span>
    <span class='id identifier rubyid_update_package_group_index'>update_package_group_index</span>
  <span class='kw'>end</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clear_content_indices-instance_method">
  
    - (<tt>Object</tt>) <strong>clear_content_indices</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clear_content_indices'>clear_content_indices</span>
  <span class='id identifier rubyid_update_packages_index'>update_packages_index</span>
  <span class='id identifier rubyid_update_errata_index'>update_errata_index</span>
  <span class='id identifier rubyid_update_package_group_index'>update_package_group_index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="errata_count-instance_method">
  
    - (<tt>Object</tt>) <strong>errata_count</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_errata_count'>errata_count</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:repoids</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_total'>total</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extended_index_attrs-instance_method">
  
    - (<tt>Object</tt>) <strong>extended_index_attrs</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 32</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extended_index_attrs'>extended_index_attrs</span>
  <span class='lbrace'>{</span><span class='symbol'>:environment</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_environment'>environment</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:environment_id</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_environment'>environment</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:clone_ids</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_clones'>clones</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:pulp_id</span><span class='rparen'>)</span><span class='comma'>,</span>
   <span class='symbol'>:product</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:product_id</span><span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
   <span class='symbol'>:default_content_view</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_content_view_version'>content_view_version</span><span class='period'>.</span><span class='id identifier rubyid_has_default_content_view?'>has_default_content_view?</span><span class='comma'>,</span>
   <span class='symbol'>:name_sort</span><span class='op'>=&gt;</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index_content-instance_method">
  
    - (<tt>Object</tt>) <strong>index_content</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index_content'>index_content</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_index_packages'>index_packages</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_index_errata'>index_errata</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_index_package_groups'>index_package_groups</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index_errata-instance_method">
  
    - (<tt>Object</tt>) <strong>index_errata</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index_errata'>index_errata</span>
  <span class='id identifier rubyid_errata'>errata</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_err'>err</span><span class='op'>|</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>
    <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_errata'>errata</span>
  <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index_package_groups-instance_method">
  
    - (<tt>Object</tt>) <strong>index_package_groups</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 113</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index_package_groups'>index_package_groups</span>
  <span class='id identifier rubyid_package_groups_map'>package_groups_map</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_package_groups'>package_groups</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pg'>pg</span><span class='op'>|</span> <span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>PackageGroup</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>PackageGroup</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>PackageGroup</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>
    <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_package_groups_map'>package_groups_map</span>
  <span class='kw'>end</span> <span class='kw'>unless</span> <span class='id identifier rubyid_package_groups_map'>package_groups_map</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index_packages-instance_method">
  
    - (<tt>Object</tt>) <strong>index_packages</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48
49
50
51
52
53</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index_packages'>index_packages</span>
  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='op'>::</span><span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_pkgs'>pkgs</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_packages'>packages</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pkg'>pkg</span><span class='op'>|</span> <span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_pkgs'>pkgs</span><span class='period'>.</span><span class='id identifier rubyid_each_slice'>each_slice</span><span class='lparen'>(</span><span class='const'>Katello</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_pulp'>pulp</span><span class='period'>.</span><span class='id identifier rubyid_bulk_load_size'>bulk_load_size</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sublist'>sublist</span><span class='op'>|</span>
    <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='op'>::</span><span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_sublist'>sublist</span>
    <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_sublist'>sublist</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="package_count-instance_method">
  
    - (<tt>Object</tt>) <strong>package_count</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 138</span>

<span class='kw'>def</span> <span class='id identifier rubyid_package_count'>package_count</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_search'>search</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:repoids</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_total'>total</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_errata_index-instance_method">
  
    - (<tt>Object</tt>) <strong>update_errata_index</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 88</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_errata_index'>update_errata_index</span>
  <span class='comment'># for each of the errata in the repo, unassociate the repo from the errata
</span>  <span class='id identifier rubyid_errata'>errata</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_err'>err</span><span class='op'>|</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_pulp_id'>pulp_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span>

  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Errata</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>

    <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_errata'>errata</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_documents'>documents</span><span class='op'>|</span>
      <span class='id identifier rubyid_documents'>documents</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_document'>document</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
          <span class='comment'># if there is more than 1 repo associated w/ the errata, remove this repo
</span>          <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_errata'>errata</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># now, for any errata that only had this repo asscociated with it, remove the errata from the index
</span>  <span class='id identifier rubyid_repoids'>repoids</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>/katello_errata/_query?q=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_repoids'>repoids</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>katello_errata</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_refresh'>refresh</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_package_group_index-instance_method">
  
    - (<tt>Object</tt>) <strong>update_package_group_index</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125
126
127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 121</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_package_group_index'>update_package_group_index</span>
  <span class='comment'># for each of the package_groups in the repo, unassociate the repo from the package_group
</span>  <span class='id identifier rubyid_pgs'>pgs</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_package_groups'>package_groups</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pg'>pg</span><span class='op'>|</span> <span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pg'>pg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_pulp_id'>pulp_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span>

  <span class='comment'># now, for any package group that only had this repo asscociated with it,
</span>  <span class='comment'># remove the package group from the index
</span>  <span class='id identifier rubyid_repoid'>repoid</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repo_id:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>/katello_package_group/_query?q=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_repoid'>repoid</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>katello_package_group</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_refresh'>refresh</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_packages_index-instance_method">
  
    - (<tt>Object</tt>) <strong>update_packages_index</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_packages_index'>update_packages_index</span>
  <span class='comment'># for each of the packages in the repo, unassociate the repo from the package
</span>  <span class='id identifier rubyid_pkgs'>pkgs</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_packages'>packages</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_pkg'>pkg</span><span class='op'>|</span> <span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_as_json'>as_json</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_pkg'>pkg</span><span class='period'>.</span><span class='id identifier rubyid_index_options'>index_options</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_pulp_id'>pulp_id</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_pulp_id'>pulp_id</span>

  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_create'>create</span> <span class='symbol'>:settings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_settings'>index_settings</span><span class='comma'>,</span> <span class='symbol'>:mappings</span> <span class='op'>=&gt;</span> <span class='const'>Package</span><span class='period'>.</span><span class='id identifier rubyid_index_mapping'>index_mapping</span>

    <span class='id identifier rubyid_import'>import</span> <span class='id identifier rubyid_pkgs'>pkgs</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_documents'>documents</span><span class='op'>|</span>
      <span class='id identifier rubyid_documents'>documents</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_document'>document</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span>
          <span class='comment'># if there is more than 1 repo associated w/ the pkg, remove this repo
</span>          <span class='id identifier rubyid_document'>document</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span> <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_pkgs'>pkgs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># now, for any package that only had this repo asscociated with it, remove the package from the index
</span>  <span class='id identifier rubyid_repoids'>repoids</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>repoids:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_pulp_id'>pulp_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Tire</span><span class='op'>::</span><span class='const'>Configuration</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='rbrace'>}</span><span class='tstring_content'>/katello_package/_query?q=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_repoids'>repoids</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Tire</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>katello_package</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_refresh'>refresh</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_related_index-instance_method">
  
    - (<tt>Object</tt>) <strong>update_related_index</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/glue/elastic_search/repository.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_related_index'>update_related_index</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_update_index'>update_index</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span><span class='period'>.</span><span class='id identifier rubyid_provider'>provider</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:update_index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu May  9 10:36:13 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.6.1 (ruby-1.9.3).
</div>

  </body>
</html>